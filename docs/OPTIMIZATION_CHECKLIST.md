# 项目优化清单

按优先级和类别整理的优化点，便于按需推进。

---

## 一、高优先级（影响核心体验）

### 1. 基础设施与依赖
| 优化点 | 现状 | 建议 |
|--------|------|------|
| Neo4j / Milvus / Redis 未常驻 | 检索常失败，降级到纯 LLM | 用 Docker Compose 或 K8s 常驻；或文档明确「最小可运行」组合 |
| 知识图谱数据未导入 | Neo4j 空库时 KG 检索为空 | 首次部署文档强调执行 `init_knowledge_graph.py` 等脚本 |

### 2. 功能待完善
| 优化点 | 位置 | 说明 |
|--------|------|------|
| 向量删除未实现 | `api/v1/knowledge.py:240` | 日志写「向量删除功能待实现」 |
| Milvus 缓存清理未实现 | `services/semantic_cache.py:271` | 缓存清理为占位，需接 Milvus delete |

### 3. 智能问答与 RAG
| 优化点 | 说明 |
|--------|------|
| 流式接口已集成 RAG | 已做：流式前先跑编排器拿上下文 |
| KG 查询已从硬编码改为实体识别 | 已做：从 RAG 结果提取 KG + KG 检索器兜底 |
| 无检索结果时的提示 | 可增加「未找到相关知识，仅基于模型回答」等用户提示 |

---

## 二、中优先级（质量与可维护性）

### 4. 代码中的「简化」与待实现
| 位置 | 内容 | 建议 |
|------|------|------|
| `doctor_agent.py:239` | 药物名称「简化处理」 | 用 NER/实体识别替代规则抽取 |
| `knowledge.py:240` | 向量删除待实现 | 实现或暂时下架该 API |
| `semantic_cache.py:271` | Milvus 缓存清理待实现 | 实现或标注为已知限制 |
| `multi_retrieval.py:141` | BM25 需从 Milvus 取文档文本 | 明确数据源，实现文档列表获取 |
| `relevance_scorer.py:118,223` | 相似度/排序为简化版 | 可加强为语义相似度或学习排序 |
| `context_manager.py:150,157` | token 估算、压缩为简化版 | 接入分词/模型 tokenizer 更准确 |
| `confidence_scorer.py:151,166` | 实体/关键词提取简化 | 与 NER/关键词服务统一 |
| `semantic_retriever.py:40,49` | 响应解析简化 | 增加错误处理与重试 |
| `image_analysis.py:88` | 图片解析结果简化处理 | 定义清晰结构并做校验 |

### 5. 对话与上下文
| 优化点 | 说明 |
|--------|------|
| 多轮对话上下文 | 当前多为单轮；可增加会话级 context 传入编排器 |
| 上下文长度与裁剪 | 已有 context_manager，可再优化裁剪策略与 token 上限 |

### 6. 错误与降级
| 优化点 | 说明 |
|--------|------|
| Neo4j/Milvus 不可用时的提示 | 已有部分日志，可增加对前端的明确状态或提示 |
| RAG 全失败时的回复话术 | 统一为「暂无相关知识库结果，仅基于通用知识回答」等 |

---

## 三、低优先级（工程与体验）

### 7. 工程与结构（README 已部分提及）
| 优化点 | 建议 |
|--------|------|
| 脚本与冗余文件 | 梳理 `backend/scripts/` 使用情况，删除或归档未用脚本 |
| 后端模块划分 | 将 `services/` 等按领域再分子模块 |
| 前端页面与组件 | 明确页面/组件分层，便于扩展 |
| 测试与覆盖 | 补充关键路径单测与少量 E2E |

### 8. 依赖与安全
| 优化点 | 建议 |
|--------|------|
| 依赖清理 | 检查 `requirements.txt` / `package.json` 未使用依赖 |
| 依赖更新 | 定期更新并做回归测试，关注安全公告 |

### 9. 日志与运维
| 优化点 | 建议 |
|--------|------|
| 日志按日归档 | 避免 `app.log` 单文件过大 |
| 日志级别与敏感信息 | 生产环境调低级别，脱敏用户输入与 token |

### 10. 文档与协作
| 优化点 | 建议 |
|--------|------|
| 快速入门 | 在 README 或 QUICKSTART 中写「最小三步跑起来」 |
| 开发/部署细节 | 在 `docs/` 补充环境变量、端口、依赖服务说明 |
| 许可证 | README 中「许可证」当前为「待定」，需确定并填写 |

### 11. Kubernetes
| 优化点 | 建议 |
|--------|------|
| 资源 request/limit | 按实际压测调整，避免过大或过小 |
| 健康检查与探针 | 确保就绪/存活探针与真实健康接口一致 |

---

## 四、建议实施顺序

1. **先做**：保证 Neo4j/Milvus/Redis 可选但文档清晰，知识图谱初始化脚本在部署流程中体现。  
2. **短期**：实现或明确「向量删除」「缓存清理」；补齐关键「简化」实现的错误处理与边界情况。  
3. **中期**：多轮对话与上下文、无检索时的统一提示、日志归档与脱敏。  
4. **长期**：模块与目录重构、依赖与 K8s 优化、文档与许可证完善。

---

## 五、与现有文档的关系

- 更细的**智能问答与 RAG 优化**（含已做项）：见 `docs/OPTIMIZATION_RECOMMENDATIONS.md`、`docs/QA_OPTIMIZATION_SUMMARY.md`。  
- **架构与设计**：见 `docs/ARCHITECTURE.md`。  
- 本清单作为**总览与待办**，便于按「高/中/低」优先级和类别推进。
